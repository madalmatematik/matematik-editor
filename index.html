<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Matematiksel Metin Düzenleyici</title>

  <!-- KaTeX (ONLINE) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>

  <!-- html2canvas + jsPDF (ONLINE) -->
  <script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg1:#6a11cb;
      --bg2:#2575fc;
      --card:#ffffff;
      --muted:#6b7280;
      --border:#e5e7eb;
      --shadow:0 18px 40px rgba(0,0,0,.18);
      --radius:18px;
      --btn-radius:14px;
    }

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background: linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      display:flex;
      justify-content:center;
      padding:24px 10px;
      box-sizing:border-box;
    }

    .wrap{
      width:min(980px, 100%);
    }

    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:22px;
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }

    h1{
      font-size:22px;
      margin:0;
      letter-spacing:.2px;
    }

    .toggle{
      display:flex;
      align-items:center;
      gap:10px;
      user-select:none;
      font-size:13px;
      color:#111827;
      font-weight:600;
    }

    .divider{
      height:2px;
      background:linear-gradient(90deg, rgba(37,117,252,.2), rgba(106,17,203,.2));
      border-radius:999px;
      margin:10px 0 18px;
    }

    label.small{
      display:block;
      font-size:13px;
      color:var(--muted);
      margin:8px 0 6px;
      font-weight:600;
    }

    select, textarea, input[type="number"], input[type="color"]{
      width:100%;
      box-sizing:border-box;
      border:1px solid var(--border);
      border-radius:12px;
      padding:10px 12px;
      outline:none;
      font-size:14px;
      background:#fff;
    }

    textarea{
      min-height:140px;
      resize:vertical;
      line-height:1.35;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.3fr 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap:12px;
      margin-top:12px;
    }

    .box{
      background:#f8fafc;
      border:1px solid #f1f5f9;
      border-radius:14px;
      padding:12px;
    }

    .row{
      display:flex;
      align-items:center;
      gap:10px;
      margin-top:10px;
      flex-wrap:wrap;
    }

    .chk{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:13px;
      font-weight:600;
      color:#111827;
      user-select:none;
    }

    .btnbar{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      margin-top:14px;
    }

    button{
      border:none;
      padding:12px 10px;
      border-radius:var(--btn-radius);
      color:#fff;
      font-weight:800;
      letter-spacing:.2px;
      cursor:pointer;
      transition:transform .06s ease, filter .2s ease;
      font-size:13px;
      user-select:none;
    }
    button:active{ transform:scale(.98); }

    .b1{ background:linear-gradient(135deg, #667eea, #764ba2); }
    .b2{ background:linear-gradient(135deg, #ff758c, #ff7eb3); }
    .b3{ background:linear-gradient(135deg, #00c6ff, #0072ff); }
    .b4{ background:linear-gradient(135deg, #f7971e, #ffd200); color:#1f2937; }
    .b5{ background:linear-gradient(135deg, #8e2de2, #4a00e0); }

    .hint{
      margin-top:12px;
      border:2px solid #f59e0b;
      background:#fff7ed;
      border-radius:12px;
      padding:10px 12px;
      color:#1f2937;
      font-size:13px;
      font-weight:650;
    }

    .previewWrap{
      margin-top:14px;
      border:2px dashed #cbd5e1;
      border-radius:14px;
      padding:16px;
      background:#fff;
      position:relative;
      overflow:auto;
    }

    /* MEB/ÖSYM paragraf stili */
    .preview{
      font-size:18px;
      line-height:1.6;
      letter-spacing:.1px;
      color:#111827;

      /* hizalama buradan yönetilecek */
      text-align: justify;
      text-justify: inter-word;
      white-space: normal;
      word-break: break-word;
    }

    .preview p{
      margin: 0 0 10px 0;
    }

    .preview .lead{
      margin-top:2px;
    }

    .preview .label{
      font-weight:900;
    }

    .preview .resultLine{
      font-weight:900;
    }

    /* KaTeX hizalamayı miras alsın (asıl fix) */
    .preview .katex-display{
      margin: 10px 0 12px;
      text-align: inherit;
    }
    .preview .katex-display > .katex{
      text-align: inherit;
    }

    /* Şeffaf modda arka planı PNG için uygunlaştır */
    .transparentOn .previewWrap{
      background:transparent;
    }
    .transparentOn .preview{
      background:transparent;
    }

    .history{
      margin-top:14px;
      border-top:1px solid #eef2f7;
      padding-top:12px;
    }
    .history h3{
      margin:0 0 8px 0;
      font-size:14px;
      color:#334155;
    }
    .histItem{
      border-left:4px solid #3b82f6;
      background:#f8fafc;
      padding:10px 12px;
      border-radius:10px;
      margin-bottom:8px;
      font-size:13px;
      color:#111827;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
      cursor:pointer;
    }
    .muted{
      font-size:12px;
      color:var(--muted);
    }

    @media (max-width: 820px){
      .grid, .grid2{ grid-template-columns: 1fr; }
      .btnbar{ grid-template-columns: 1fr 1fr; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card" id="appCard">
      <header>
        <h1>Matematiksel Metin Düzenleyici</h1>
        <label class="toggle">
          <input type="checkbox" id="autoRender">
          Otomatik Render
        </label>
      </header>

      <div class="divider"></div>

      <label class="small">ÖRNEK ŞABLONLAR</label>
      <select id="templateSelect">
        <option value="custom">Seçiniz…</option>
        <option value="turev">Türev Örneği</option>
        <option value="integral">Belirli İntegral Örneği</option>
        <option value="limit">Limit Örneği</option>
        <option value="matris">Matris</option>
        <option value="parabol">Parabol Fonksiyonu</option>
      </select>

      <label class="small" id="inputLabel">Metin / LaTeX Girişi</label>
      <textarea id="inputText" placeholder="Metninizi buraya yapıştırın..."></textarea>

      <div class="grid">
        <div class="box">
          <label class="small">YAZI TİPİ</label>
          <select id="fontFamily">
            <option value="Arial, sans-serif">Arial</option>
            <option value="'Times New Roman', Times, serif">Times New Roman</option>
            <option value="Georgia, serif">Georgia</option>
            <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
            <option value="'Noto Sans', sans-serif">Noto Sans</option>
          </select>
        </div>

        <div class="box">
          <label class="small">BOYUT (PX)</label>
          <input type="number" id="fontSize" min="12" max="48" value="22">
        </div>

        <div class="box">
          <label class="small">METİN RENGİ</label>
          <input type="color" id="textColor" value="#111827">
        </div>
      </div>

      <div class="grid2">
        <div class="box">
          <label class="small">ARKA PLAN</label>
          <input type="color" id="bgColor" value="#ffffff">
          <div class="row">
            <label class="chk"><input type="checkbox" id="transparent" checked> Şeffaf</label>
          </div>
        </div>

        <div class="box">
          <label class="small">HİZALAMA</label>
          <select id="align">
            <option value="left">Sola</option>
            <option value="center">Ortala</option>
            <option value="right">Sağa</option>
            <option value="justify" selected>İki yana yasla</option>
          </select>
          <div class="muted" style="margin-top:6px;">
            Not: KaTeX blokları da bu hizalamayı miras alır.
          </div>
        </div>

        <div class="box">
          <label class="small">STİL</label>
          <div class="row">
            <label class="chk"><input type="checkbox" id="bold"> Kalın</label>
          </div>
          <div class="muted" style="margin-top:6px;">
            “Denklemi kuralım:” ve “Sonuç:” otomatik kalınlaştırılır.
          </div>
        </div>
      </div>

      <div class="btnbar">
        <button class="b1" id="btnRender">GÖRÜNTÜLE</button>
        <button class="b2" id="btnClear">TEMİZLE</button>
        <button class="b3" id="btnCopy">KOPYALA</button>
        <button class="b4" id="btnPNG">PNG İNDİR</button>
        <button class="b5" id="btnPDF">PDF İNDİR</button>
      </div>

      <div class="hint">
        Şeffaf PNG için: “Şeffaf” seçeneğini işaretleyin. Ardından “PNG İNDİR” ile kaydedin.
      </div>

      <div class="previewWrap" id="previewWrap">
        <div class="preview" id="preview"></div>
      </div>

      <div class="history">
        <h3>GEÇMİŞ (Son 5)</h3>
        <div id="historyList"></div>
      </div>
    </div>
  </div>

<script>
(function(){
  // ---------------------------
  // 1) Durum / Varsayılanlar
  // ---------------------------
  const el = (id) => document.getElementById(id);

  const autoRenderEl = el('autoRender');
  const transparentEl = el('transparent');
  const alignEl = el('align');
  const fontFamilyEl = el('fontFamily');
  const fontSizeEl = el('fontSize');
  const textColorEl = el('textColor');
  const bgColorEl = el('bgColor');
  const boldEl = el('bold');
  const inputEl = el('inputText');
  const previewEl = el('preview');
  const previewWrapEl = el('previewWrap');
  const appCardEl = el('appCard');
  const historyListEl = el('historyList');
  const templateSelectEl = el('templateSelect');
  const inputLabelEl = el('inputLabel');

  // Otomatik render ilk açılışta KAPALI
  autoRenderEl.checked = false;

  // Şeffaf + Justify ilk açılışta AÇIK
  transparentEl.checked = true;
  alignEl.value = "justify";

  // Bu oturum boyunca: ilk kez görüntüleye basınca auto render aktifleşsin
  const SESSION_KEY = "math_editor_session_autorender";
  const sessionAuto = sessionStorage.getItem(SESSION_KEY) === "1";
  if(sessionAuto){
    autoRenderEl.checked = true;
  }

  // Geçmiş (son 5)
  const HIST_KEY = "math_editor_history_v1";
  const loadHistory = () => {
    try{
      const arr = JSON.parse(localStorage.getItem(HIST_KEY) || "[]");
      return Array.isArray(arr) ? arr.slice(0,5) : [];
    }catch(e){ return []; }
  };
  const saveHistory = (text) => {
    const t = (text || "").trim();
    if(!t) return;
    let arr = loadHistory();
    arr = arr.filter(x => x !== t);
    arr.unshift(t);
    arr = arr.slice(0,5);
    localStorage.setItem(HIST_KEY, JSON.stringify(arr));
    renderHistory();
  };
  const renderHistory = () => {
    historyListEl.innerHTML = "";
    const arr = loadHistory();
    if(arr.length === 0){
      const d = document.createElement("div");
      d.className = "muted";
      d.textContent = "Henüz kayıt yok.";
      historyListEl.appendChild(d);
      return;
    }
    arr.forEach(item => {
      const div = document.createElement("div");
      div.className = "histItem";
      div.title = "Tıkla: geri yükle";
      div.textContent = item.replace(/\s+/g, " ").slice(0, 220);
      div.addEventListener("click", () => {
        inputEl.value = item;
        doRender(true);
      });
      historyListEl.appendChild(div);
    });
  };
  renderHistory();

  // ---------------------------
  // 2) Şablonlar
  // ---------------------------
  const templates = {
    turev: "f(x) = 3x^2 + 2x - 5\nf'(x) = 6x + 2",
    integral: "\\int_{0}^{1} x^2\\,dx = \\frac{1}{3}",
    limit: "\\lim_{x \\to 0} \\frac{\\sin x}{x} = 1",
    matris: "\\begin{pmatrix} a & b \\\\ c & d \\end{pmatrix}",
    parabol: "f(x) = x^2 - 4x + 3\nTepe noktası: (2, -1)"
  };

  templateSelectEl.addEventListener("change", () => {
    const v = templateSelectEl.value;
    if(v && templates[v]){
      inputEl.value = templates[v];
      doRender(true);
    }
  });

  // ---------------------------
  // 3) Metin -> HTML (MEB/ÖSYM + özel kurallar)
  // ---------------------------

  // Satır “saf denklem” mi? (blok KaTeX)
  function isPureMathLine(line){
    const t = line.trim();
    if(!t) return false;

    // Etiket/başlık satırları blok olmasın
    if (t.includes(":")) return false;

    // Çok cümleli metinler blok olmasın
    if (/[.!?]$/.test(t) && t.length > 25) return false;

    // İçinde “kelime” çoksa metindir (Senaryo gibi)
    // Matematikte de harf var; burada kaba bir filtre:
    const wordLike = t.match(/[A-Za-zĞÜŞİÖÇğüşıöç]{3,}/g);
    if(wordLike && wordLike.length >= 2) return false;

    // Denklem göstergeleri varsa ve uzun cümle değilse blok kabul et
    const hasMathSignals = /\\(frac|sqrt|sin|cos|tan|lim|int|sum|prod|begin|end|Rightarrow|implies|cdot|times)|[=<>^_]/.test(t);
    if(!hasMathSignals) return false;

    // “Birimler: …” gibi satırlar zaten ":" ile eleniyor
    return true;
  }

  // Inline KaTeX için: satır içindeki LaTeX parçalarını \(...\) ile sar
  // (Auto-render bu delimiters’ları yakalayıp render eder)
  function wrapInlineLatex(text){
    if(!text) return text;

    // Zaten \( \) veya $$ varsa dokunma
    // Burada sadece “\komut{...}...” parçalarını yakalayıp saracağız.
    // Bu regex 1 seviyeli { } yakalar (çoğu kullanım için yeterli).
    const re = /\\[a-zA-Z]+(?:\s*\{[^{}]*\})*(?:\s*\([^()]*\))?(?:\s*\[[^\[\]]*\])?(?:\s*\^[^{\s]+|\s*_\{[^{}]*\}|\s*_\w+|\s*\^\{[^{}]*\})*/g;

    return text.replace(re, (m) => {
      // Eğer zaten delimiters içinde ise tekrar sarmayalım
      if(m.includes("\\(") || m.includes("\\)") || m.includes("$$")) return m;
      return "\\(" + m + "\\)";
    });
  }

  // “Denklemi kuralım:” özel kuralı:
  // - Etiket bold
  // - Sağındaki denklem alt satıra blok
  function splitSpecialLines(line){
    const t = line.trim();
    const lower = t.toLowerCase();

    // Denklem etiketi
    if(/^denklemi\s*kuralım\s*:/.test(lower)){
      const parts = t.split(":");
      const label = parts.shift(); // "Denklemi kuralım"
      const rest = parts.join(":").trim();
      return { kind: "label+math", label: label + ":", math: rest };
    }

    // Sonuç etiketi
    if(/^sonuç\s*:/.test(lower)){
      return { kind: "result", text: t };
    }

    // Çözüm etiketi (heading)
    if(/^çözüm\s*:?$/.test(lower)){
      return { kind: "heading", text: "Çözüm:" };
    }

    return { kind: "normal", text: line };
  }

  // Metni satır satır işleyip HTML üret
  function buildPreviewHTML(raw){
    const lines = (raw || "").replace(/\r\n/g,"\n").split("\n");

    let html = "";
    for(let i=0;i<lines.length;i++){
      const line = lines[i];
      const trimmed = line.trim();

      if(!trimmed){
        // boş satır -> paragraf boşluğu
        html += `<p class="lead">&nbsp;</p>`;
        continue;
      }

      const sp = splitSpecialLines(line);

      if(sp.kind === "heading"){
        html += `<p><span class="label">${escapeHtml(sp.text)}</span></p>`;
        continue;
      }

      if(sp.kind === "result"){
        // Sonuç: satırını tamamen bold yap
        const safe = wrapInlineLatex(escapeHtmlKeepLatex(sp.text));
        html += `<p class="resultLine">${safe}</p>`;
        continue;
      }

      if(sp.kind === "label+math"){
        // Label bold, denklem alt satır blok
        html += `<p><span class="label">${escapeHtml(sp.label)}</span></p>`;
        if(sp.math){
          const m = sp.math.trim();
          html += `<div class="mathblock">$$${escapeHtmlKeepLatex(m)}$$</div>`;
        }
        continue;
      }

      // Normal satır:
      // Eğer saf denklem satırı ise blok yap
      if(isPureMathLine(trimmed)){
        html += `<div class="mathblock">$$${escapeHtmlKeepLatex(trimmed)}$$</div>`;
      } else {
        // metin satırı: latex parçalarını inline sar
        const safe = wrapInlineLatex(escapeHtmlKeepLatex(line));
        html += `<p>${safe}</p>`;
      }
    }

    return html;
  }

  // HTML kaçış (tam metin)
  function escapeHtml(s){
    return (s || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;")
      .replaceAll("'","&#039;");
  }

  // Metinde KaTeX komutları \ ile başlıyor; bunları bozmadan kaçışlayalım:
  // - <, >, &, " yine kaçsın
  // - backslash ve { } aynen kalsın
  function escapeHtmlKeepLatex(s){
    return (s || "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;");
  }

  // ---------------------------
  // 4) Render + Stil Uygulama
  // ---------------------------
  function applyStyles(){
    // Arka plan / şeffaf
    const transparent = transparentEl.checked;
    if(transparent){
      appCardEl.classList.add("transparentOn");
      previewWrapEl.style.background = "transparent";
      previewEl.style.background = "transparent";
    }else{
      appCardEl.classList.remove("transparentOn");
      previewWrapEl.style.background = bgColorEl.value;
      previewEl.style.background = bgColorEl.value;
    }

    // Font / size / color / bold
    previewEl.style.fontFamily = fontFamilyEl.value;
    previewEl.style.fontSize = Number(fontSizeEl.value || 22) + "px";
    previewEl.style.color = textColorEl.value;

    // Hizalama FIX: container'a ver, KaTeX display inherit ediyor
    const a = alignEl.value;
    previewEl.style.textAlign = a;
    if(a === "justify"){
      previewEl.style.textJustify = "inter-word";
    }else{
      previewEl.style.textJustify = "auto";
    }

    // Genel bold (opsiyon)
    if(boldEl.checked){
      previewEl.style.fontWeight = "800";
    }else{
      previewEl.style.fontWeight = "400";
    }
  }

  // KaTeX render
  function runKatexAutoRender(){
    if(typeof renderMathInElement !== "function") return;
    renderMathInElement(previewEl, {
      delimiters: [
        {left: "$$", right: "$$", display: true},
        {left: "\\[", right: "\\]", display: true},
        {left: "\\(", right: "\\)", display: false},
        {left: "$", right: "$", display: false}
      ],
      throwOnError: false,
      strict: "ignore"
    });
  }

  function doRender(fromAuto){
    const raw = inputEl.value || "";

    // HTML üret
    previewEl.innerHTML = buildPreviewHTML(raw);

    // Stil uygula
    applyStyles();

    // KaTeX render
    runKatexAutoRender();

    // Geçmişe kaydet (manuel render veya şablon değişimi)
    if(!fromAuto){
      saveHistory(raw);
    }
  }

  // ---------------------------
  // 5) Otomatik Render Mantığı (İlk GÖRÜNTÜLE sonrası)
  // ---------------------------
  let autoEnabled = sessionStorage.getItem(SESSION_KEY) === "1";

  function setSessionAuto(on){
    autoEnabled = on;
    sessionStorage.setItem(SESSION_KEY, on ? "1" : "0");
    autoRenderEl.checked = on;
  }

  // Checkbox manuel kontrol edilebilir
  autoRenderEl.addEventListener("change", () => {
    setSessionAuto(autoRenderEl.checked);
    if(autoRenderEl.checked){
      doRender(true);
    }
  });

  // İlk kez GÖRÜNTÜLE’ye basınca auto render aç
  let firstRenderDone = false;

  el("btnRender").addEventListener("click", () => {
    doRender(false);

    if(!firstRenderDone){
      firstRenderDone = true;
      // Bu oturum boyunca otomatik render aç
      setSessionAuto(true);
    }
  });

  // Otomatik render açıksa her yazımda render
  let typingTimer = null;
  inputEl.addEventListener("input", () => {
    if(!autoEnabled) return;
    clearTimeout(typingTimer);
    typingTimer = setTimeout(() => doRender(true), 180);
  });

  // Stil değişikliklerinde: auto açıksa anında uygula + render
  const styleTriggers = [fontFamilyEl, fontSizeEl, textColorEl, bgColorEl, transparentEl, alignEl, boldEl];
  styleTriggers.forEach(x => {
    x.addEventListener("input", () => {
      applyStyles();
      if(autoEnabled){
        doRender(true);
      }
    });
    x.addEventListener("change", () => {
      applyStyles();
      if(autoEnabled){
        doRender(true);
      }
    });
  });

  // ---------------------------
  // 6) Temizle / Kopyala / PNG / PDF
  // ---------------------------
  el("btnClear").addEventListener("click", () => {
    inputEl.value = "";
    previewEl.innerHTML = "";
  });

  el("btnCopy").addEventListener("click", async () => {
    const text = inputEl.value || "";
    try{
      await navigator.clipboard.writeText(text);
      alert("Kopyalandı.");
    }catch(e){
      // fallback
      inputEl.select();
      document.execCommand("copy");
      alert("Kopyalandı.");
    }
  });

  async function exportPNG(){
    applyStyles();
    if(typeof html2canvas !== "function"){
      alert("html2canvas yüklenemedi (internet bağlantısı?).");
      return;
    }
    const prevScroll = previewWrapEl.scrollTop;
    previewWrapEl.scrollTop = 0;

    const canvas = await html2canvas(previewWrapEl, {
      backgroundColor: transparentEl.checked ? null : bgColorEl.value,
      scale: 2,
      useCORS: true
    });

    previewWrapEl.scrollTop = prevScroll;

    const link = document.createElement("a");
    link.download = "matematik.png";
    link.href = canvas.toDataURL("image/png");
    link.click();
  }

  async function exportPDF(){
    applyStyles();
    if(typeof html2canvas !== "function"){
      alert("html2canvas yüklenemedi (internet bağlantısı?).");
      return;
    }
    if(!window.jspdf || !window.jspdf.jsPDF){
      alert("jsPDF yüklenemedi (internet bağlantısı?).");
      return;
    }

    const prevScroll = previewWrapEl.scrollTop;
    previewWrapEl.scrollTop = 0;

    const canvas = await html2canvas(previewWrapEl, {
      backgroundColor: transparentEl.checked ? "#ffffff" : bgColorEl.value,
      scale: 2,
      useCORS: true
    });

    previewWrapEl.scrollTop = prevScroll;

    const imgData = canvas.toDataURL("image/png");
    const { jsPDF } = window.jspdf;

    const pdf = new jsPDF("p", "mm", "a4");
    const pageW = 210;
    const pageH = 297;

    // Canvas boyutlarını mm’ye ölçekle
    const imgW = pageW;
    const imgH = (canvas.height * imgW) / canvas.width;

    let y = 0;
    let heightLeft = imgH;

    pdf.addImage(imgData, "PNG", 0, y, imgW, imgH);
    heightLeft -= pageH;

    while(heightLeft > 0){
      y = heightLeft - imgH;
      pdf.addPage();
      pdf.addImage(imgData, "PNG", 0, y, imgW, imgH);
      heightLeft -= pageH;
    }

    pdf.save("matematik.pdf");
  }

  el("btnPNG").addEventListener("click", exportPNG);
  el("btnPDF").addEventListener("click", exportPDF);

  // İlk açılış: sadece stil uygula (render yok)
  applyStyles();

})();
</script>
</body>
</html>
